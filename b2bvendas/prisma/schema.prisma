generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ==========================================
// ENUMS - Tipos Enumerados
// ==========================================

enum TipoUsuario {
  admin       // Administrador do sistema
  fornecedor  // Fornecedor/Vendedor
  cliente     // Comprador/Cliente
}

enum StatusPedido {
  pendente      // Aguardando confirmação
  confirmado    // Pedido confirmado
  processando   // Em processamento/preparação
  enviado       // Enviado para entrega
  entregue      // Entrega realizada
  cancelado     // Pedido cancelado
}

enum TipoMovimentacao {
  entrada   // Entrada de mercadoria
  saida     // Saída de mercadoria
  ajuste    // Ajuste de inventário
}

enum TipoDesconto {
  percentual  // Desconto em porcentagem
  fixo        // Desconto em valor fixo
}

// ==========================================
// MODELO: Usuario
// Usuários do sistema (todos os perfis)
// ==========================================
model Usuario {
  id            String       @id @default(cuid())
  email         String       @unique
  senha         String
  nome          String
  tipo          TipoUsuario  @default(cliente)
  telefone      String?
  avatar        String?
  ativo         Boolean      @default(true)
  criadoEm      DateTime     @default(now()) @map("criado_em")
  atualizadoEm  DateTime     @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  fornecedor    Fornecedor?
  cliente       Cliente?
  notificacoes  Notificacao[]
  
  @@map("usuarios")
}

// ==========================================
// MODELO: Fornecedor
// Empresas que vendem produtos na plataforma
// ==========================================
model Fornecedor {
  id              String    @id @default(cuid())
  usuarioId       String    @unique @map("usuario_id")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  razaoSocial     String    @map("razao_social")
  nomeFantasia    String?   @map("nome_fantasia")
  slug            String    @unique
  cnpj            String    @unique
  descricao       String?
  logo            String?
  banner          String?
  endereco        String?
  cidade          String?
  estado          String?
  cep             String?
  verificado      Boolean   @default(false)
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  produtos        Produto[]
  pedidos         Pedido[]
  listasPreco     ListaPreco[]
  clientes        ClienteFornecedor[]
  
  @@map("fornecedores")
}

// ==========================================
// MODELO: Cliente
// Empresas compradoras na plataforma
// ==========================================
model Cliente {
  id              String    @id @default(cuid())
  usuarioId       String    @unique @map("usuario_id")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  razaoSocial     String    @map("razao_social")
  nomeFantasia    String?   @map("nome_fantasia")
  cnpj            String    @unique
  inscricaoEstadual String? @map("inscricao_estadual")
  endereco        String?
  cidade          String?
  estado          String?
  cep             String?
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  pedidos         Pedido[]
  precosCustomizados PrecoCustomizado[]
  fornecedores    ClienteFornecedor[]
  
  @@map("clientes")
}

// ==========================================
// MODELO: ClienteFornecedor
// Relacionamento N:N entre Cliente e Fornecedor
// ==========================================
model ClienteFornecedor {
  id              String      @id @default(cuid())
  clienteId       String      @map("cliente_id")
  cliente         Cliente     @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  fornecedorId    String      @map("fornecedor_id")
  fornecedor      Fornecedor  @relation(fields: [fornecedorId], references: [id], onDelete: Cascade)
  listaPrecoId    String?     @map("lista_preco_id")
  listaPreco      ListaPreco? @relation(fields: [listaPrecoId], references: [id])
  criadoEm        DateTime    @default(now()) @map("criado_em")
  
  @@unique([clienteId, fornecedorId])
  @@map("clientes_fornecedores")
}

// ==========================================
// MODELO: Categoria
// Categorias de produtos (hierárquica)
// ==========================================
model Categoria {
  id              String      @id @default(cuid())
  nome            String
  slug            String      @unique
  descricao       String?
  imagem          String?
  categoriaPaiId  String?     @map("categoria_pai_id")
  categoriaPai    Categoria?  @relation("CategoriaFilhos", fields: [categoriaPaiId], references: [id])
  subcategorias   Categoria[] @relation("CategoriaFilhos")
  produtos        Produto[]
  criadoEm        DateTime    @default(now()) @map("criado_em")
  atualizadoEm    DateTime    @updatedAt @map("atualizado_em")
  
  @@map("categorias")
}

// ==========================================
// MODELO: Produto
// Produtos do catálogo
// ==========================================
model Produto {
  id                  String    @id @default(cuid())
  fornecedorId        String    @map("fornecedor_id")
  fornecedor          Fornecedor @relation(fields: [fornecedorId], references: [id], onDelete: Cascade)
  categoriaId         String?   @map("categoria_id")
  categoria           Categoria? @relation(fields: [categoriaId], references: [id])
  nome                String
  slug                String
  sku                 String
  descricao           String?
  precoBase           Decimal   @map("preco_base") @db.Decimal(10, 2)
  imagens             String[]
  ativo               Boolean   @default(true)
  
  // Controle de Estoque
  quantidadeEstoque   Int       @default(0) @map("quantidade_estoque")
  estoqueMinimo       Int       @default(0) @map("estoque_minimo")
  estoqueMaximo       Int       @default(1000) @map("estoque_maximo")
  
  // Informações adicionais
  peso                Decimal?  @db.Decimal(10, 3)
  unidadeMedida       String?   @map("unidade_medida")
  
  criadoEm            DateTime  @default(now()) @map("criado_em")
  atualizadoEm        DateTime  @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  itensPedido         ItemPedido[]
  precosCustomizados  PrecoCustomizado[]
  itensListaPreco     ItemListaPreco[]
  movimentacoesEstoque MovimentacaoEstoque[]
  
  @@unique([fornecedorId, sku])
  @@unique([fornecedorId, slug])
  @@map("produtos")
}

// ==========================================
// MODELO: ListaPreco
// Listas de preços para grupos de clientes
// ==========================================
model ListaPreco {
  id              String        @id @default(cuid())
  fornecedorId    String        @map("fornecedor_id")
  fornecedor      Fornecedor    @relation(fields: [fornecedorId], references: [id], onDelete: Cascade)
  nome            String
  descricao       String?
  tipoDesconto    TipoDesconto  @default(percentual) @map("tipo_desconto")
  valorDesconto   Decimal       @map("valor_desconto") @db.Decimal(10, 2)
  ativo           Boolean       @default(true)
  criadoEm        DateTime      @default(now()) @map("criado_em")
  atualizadoEm    DateTime      @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  itens           ItemListaPreco[]
  clientes        ClienteFornecedor[]
  
  @@map("listas_preco")
}

// ==========================================
// MODELO: ItemListaPreco
// Itens específicos de uma lista de preços
// ==========================================
model ItemListaPreco {
  id              String      @id @default(cuid())
  listaPrecoId    String      @map("lista_preco_id")
  listaPreco      ListaPreco  @relation(fields: [listaPrecoId], references: [id], onDelete: Cascade)
  produtoId       String      @map("produto_id")
  produto         Produto     @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  precoEspecial   Decimal?    @map("preco_especial") @db.Decimal(10, 2)
  
  @@unique([listaPrecoId, produtoId])
  @@map("itens_lista_preco")
}

// ==========================================
// MODELO: PrecoCustomizado
// Preço específico por cliente/produto
// ==========================================
model PrecoCustomizado {
  id              String    @id @default(cuid())
  clienteId       String    @map("cliente_id")
  cliente         Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  produtoId       String    @map("produto_id")
  produto         Produto   @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  preco           Decimal   @db.Decimal(10, 2)
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")
  
  @@unique([clienteId, produtoId])
  @@map("precos_customizados")
}

// ==========================================
// MODELO: Pedido
// Pedidos de compra
// ==========================================
model Pedido {
  id                    String        @id @default(cuid())
  numeroPedido          String        @unique @map("numero_pedido")
  clienteId             String        @map("cliente_id")
  cliente               Cliente       @relation(fields: [clienteId], references: [id])
  fornecedorId          String        @map("fornecedor_id")
  fornecedor            Fornecedor    @relation(fields: [fornecedorId], references: [id])
  status                StatusPedido  @default(pendente)
  subtotal              Decimal       @db.Decimal(10, 2)
  desconto              Decimal       @default(0) @db.Decimal(10, 2)
  frete                 Decimal       @default(0) @db.Decimal(10, 2)
  total                 Decimal       @db.Decimal(10, 2)
  observacoes           String?
  
  // Endereço de entrega
  enderecoEntrega       String?       @map("endereco_entrega")
  cidadeEntrega         String?       @map("cidade_entrega")
  estadoEntrega         String?       @map("estado_entrega")
  cepEntrega            String?       @map("cep_entrega")
  
  // Rastreamento
  codigoRastreio        String?       @map("codigo_rastreio")
  previsaoEntrega       DateTime?     @map("previsao_entrega")
  dataEntrega           DateTime?     @map("data_entrega")
  
  criadoEm              DateTime      @default(now()) @map("criado_em")
  atualizadoEm          DateTime      @updatedAt @map("atualizado_em")
  
  // Relacionamentos
  itens                 ItemPedido[]
  historicoStatus       HistoricoStatusPedido[]
  
  @@map("pedidos")
}

// ==========================================
// MODELO: ItemPedido
// Itens de um pedido
// ==========================================
model ItemPedido {
  id              String    @id @default(cuid())
  pedidoId        String    @map("pedido_id")
  pedido          Pedido    @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produtoId       String    @map("produto_id")
  produto         Produto   @relation(fields: [produtoId], references: [id])
  quantidade      Int
  precoUnitario   Decimal   @map("preco_unitario") @db.Decimal(10, 2)
  precoTotal      Decimal   @map("preco_total") @db.Decimal(10, 2)
  
  @@unique([pedidoId, produtoId])
  @@map("itens_pedido")
}

// ==========================================
// MODELO: HistoricoStatusPedido
// Histórico de alterações de status do pedido
// ==========================================
model HistoricoStatusPedido {
  id              String        @id @default(cuid())
  pedidoId        String        @map("pedido_id")
  pedido          Pedido        @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  status          StatusPedido
  observacao      String?
  criadoEm        DateTime      @default(now()) @map("criado_em")
  criadoPor       String?       @map("criado_por")
  
  @@map("historico_status_pedidos")
}

// ==========================================
// MODELO: MovimentacaoEstoque
// Registro de movimentações de estoque
// ==========================================
model MovimentacaoEstoque {
  id                String           @id @default(cuid())
  produtoId         String           @map("produto_id")
  produto           Produto          @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  tipo              TipoMovimentacao
  quantidade        Int
  estoqueAnterior   Int              @map("estoque_anterior")
  estoqueAtual      Int              @map("estoque_atual")
  motivo            String
  referencia        String?
  criadoEm          DateTime         @default(now()) @map("criado_em")
  criadoPor         String?          @map("criado_por")
  
  @@map("movimentacoes_estoque")
}

// ==========================================
// MODELO: Notificacao
// Notificações do sistema
// ==========================================
model Notificacao {
  id              String    @id @default(cuid())
  usuarioId       String    @map("usuario_id")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  titulo          String
  mensagem        String
  tipo            String
  lida            Boolean   @default(false)
  dados           Json?
  criadoEm        DateTime  @default(now()) @map("criado_em")
  
  @@map("notificacoes")
}
